<html>
<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load('visualization', '1.1', {packages: ['line']});
        google.setOnLoadCallback(drawChart);

        function drawChart() {

            // TODO make async
            var jsonData = {};
            $.ajax({
                url: "/logs",
                dataType: "json",
                async: false
            }).done(function (data) {
                jsonData = data
            });

            var data = createDataTable(jsonData);

            var options = {
                chart: {
                    title: 'Arduino Monitor',
                    subtitle: 'POT values'
                },
                width: 900,
                height: 500
            };

            var chart = new google.charts.Line(document.getElementById('linechart_material'));

            chart.draw(data, options);
        }

        function createDataTable(logs) {
            var rows = [];
            for (var i = 0; i < logs.length; i++) {
                rows.push([new Date(logs[i].timestamp), logs[i].value]);
            }

            var data = new google.visualization.DataTable();
            data.addColumn("date", "Time");
            data.addColumn("number", "Value");
            data.addRows(rows);

            return data;
        }
    </script>
</head>
<body>
<div id="linechart_material"></div>
<div>
    <button type="button" onclick="drawChart()">Refresh</button>
</div>
</body>
</html>

